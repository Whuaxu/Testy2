<div class="chat-container">
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="user-info">
                <div class="avatar">{{ getUserInitial() }}</div>
                <span class="username">{{ currentUser()?.username }}</span>
            </div>
            <div class="header-actions">
                <button class="new-chat-btn" (click)="showNewChatModal.set(true)" title="Nueva conversación">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14M5 12h14" />
                    </svg>
                </button>
                <button class="logout-btn" (click)="logout()" title="Cerrar sesión">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                        <polyline points="16 17 21 12 16 7" />
                        <line x1="21" y1="12" x2="9" y2="12" />
                    </svg>
                </button>
            </div>
        </div>
        <app-conversation-list [conversations]="conversations()" [selectedConversationId]="selectedConversation()?.id"
            [currentUserId]="currentUser()?.id" [onlineUsers]="wsService.onlineUsers()"
            (conversationSelected)="onConversationSelected($event)" />
    </div>
    <div class="main-content">
        @if (selectedConversation(); as conversation) {
        <app-chat-window [conversation]="conversation" [currentUser]="currentUser()"
            (messageSent)="onMessageSent($event)" />
        } @else {
        <div class="no-conversation">
            <div class="empty-state">
                <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="1">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                </svg>
                <h3>Selecciona una conversación</h3>
                <p>O inicia una nueva conversación con el botón +</p>
            </div>
        </div>
        }
    </div>
</div>

@if (showNewChatModal()) {
      <app-new-chat
        [users]="availableUsers()"
        [currentUserId]="currentUser()?.id"
        (close)="showNewChatModal.set(false)"
        (userSelected)="startNewChat($event)"
      />
    }